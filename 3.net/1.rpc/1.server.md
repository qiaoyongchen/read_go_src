qiaoyongchen@hotmail.com

go1.17

# 1.介绍

rpc 是 go 利用对外暴露的方法实现跨网络通信的一种方式。

一般我们这样使用：

```go
package main

import (
	"fmt"
	"log"
	"net"
	"net/rpc"
)

type Svc struct {} // 定义一个 service 

type Request struct { // 定义参数结构体
	A string
	B string
}

// 定义处理方法
func (svc *Svc) Conbine(r Request, rst *string) error {
	*rst = r.A + r.B
	return nil
}

func main() {
	// server
	svr := rpc.NewServer() // 一个 server
	svr.Register(&Svc{}) // 注册一个 service 
	lis, err := net.Listen("tcp", ":1234") // 监听一个地址
	if err != nil {
		log.Fatal("listen error", err)
	}
	go func() {
		for {
			conn, err := lis.Accept() // 接受一个链接
			if err != nil {
				log.Fatal("Accept error:", err)
			}
			svr.ServeConn(conn) // 链接交给 server处理
		}
    }()

	// client
	cli, err := rpc.Dial("tcp", ":1234") // 客户端拨号
	if err != nil {
		log.Fatal("dial error", err)
	}

	var rst string // 请求的结果放这里
	req := Request{ // 请求的参数结构体
		A: "A",
		B: "B",
	}
	cli.Call("Svc.Conbine", req, &rst) // 客户端请求
	fmt.Println(rst) // 打印结果
}
```

从上面可以看出，通过 ip 和 port 对外提供访问的成为server，提供具体访问的结构体成为 service，该 service 的方法称为 method。客户端可以通过 call("service.method", ...) 来请求具体的服务。另外，method 格式有一定要求，第一个参数为请求，第二个参数为结果（必须为指针，因为会被修改），并且返回 error。具体对应会在源码中清晰的看到。

# 2.源码

